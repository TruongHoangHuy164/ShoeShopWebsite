@using Microsoft.EntityFrameworkCore
@using ShoeShopWebsite.Models
@using Microsoft.AspNetCore.Authorization
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - ShoeShopWebsite</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true">
    <link rel="stylesheet" href="~/ShoeShopWebsite.styles.css" asp-append-version="true">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    @RenderSection("Styles", required: false)
</head>
<body>
    <!-- Toast container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Thông báo</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body"></div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(90deg, #FFBD71, #FFDCA2); border-radius: 15px; margin: 10px auto; max-width: 1450px;">
            <div class="container">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">
                    <img src="~/images/logoshoe.png" alt="ShoeShop Logo" class="logo" style="max-height: 40px; transition: transform 0.3s ease;">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon" style="color: #333;"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-controller="Home" asp-action="Index">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-controller="Product" asp-action="Index">Shop</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link text-dark dropdown-toggle" href="#" id="categoryDropdown"
                               role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Categories
                            </a>
                            <ul class="dropdown-menu" style="background-color: #F5F5DC; border-radius: 10px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                <li><a class="dropdown-item" asp-controller="Category" asp-action="Index">All Categories</a></li>
                                @if (User.IsInRole(SD.Role_Admin))
                                {
                                    <li><a class="dropdown-item" asp-controller="Category" asp-action="Create">Add Category</a></li>
                                }
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" asp-controller="Color" asp-action="Index">Colors</a></li>
                                <li><a class="dropdown-item" asp-controller="Size" asp-action="Index">Sizes</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-controller="Contact" asp-action="Index">Contact</a>
                        </li>
                        @if (User.IsInRole(SD.Role_Admin))
                        {
                            <li class="nav-item">
                                <a class="nav-link text-dark admin-dashboard-link" asp-controller="Admin" asp-action="Dashboard">
                                    <i class="bi bi-speedometer2 me-1"></i> Admin Dashboard
                                </a>
                            </li>
                        }

                        else if (User.IsInRole(SD.Role_Employee))
                        {
                            <li class="nav-item">
                                <a class="nav-link text-dark employee-dashboard-link" asp-controller="Employee" asp-action="Dashboard">
                                    <i class="bi bi-speedometer2 me-1"></i> Employee Dashboard
                                </a>
                            </li>
                        }
                    </ul>
                </div>
                <div class="d-flex align-items-center">
                    <a class="nav-link text-dark me-3" asp-controller="Cart" asp-action="Index">
                        <i class="bi bi-cart"></i> <span id="cartCount" class="cart-count">Cart (0)</span>
                    </a>
                    <a class="nav-link text-dark me-3" asp-controller="Product" asp-action="Wishlist">
                        <i class="bi bi-heart"></i> <span id="wishlistCount" class="wishlist-count">Wishlist (0)</span>
                    </a>
                    <partial name="_LoginPartial" />
                </div>
            </div>
        </nav>
    </header>

    <div class="container mt-5">
        <main role="main">
            @RenderBody()
        </main>
    </div>

    <footer class="bg-dark text-white py-5 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase mb-3">ShoeShop</h5>
                    <p>
                        ShoeShop - Cửa hàng giày thể thao hàng đầu, mang đến sản phẩm chất lượng cao, phong cách hiện đại. Chúng tôi tự hào là nguồn cảm hứng cho phong cách của bạn!
                    </p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase mb-3">Liên kết nhanh</h5>
                    <ul class="list-unstyled">
                        <li><a href="@Url.Action("Index", "Home")" class="text-white text-decoration-none">Trang chủ</a></li>
                        <li><a href="@Url.Action("Index", "Product")" class="text-white text-decoration-none">Cửa hàng</a></li>
                        <li><a href="@Url.Action("Index", "Contact")" class="text-white text-decoration-none">Liên hệ</a></li>
                        <li><a href="@Url.Action("Index", "Category")" class="text-white text-decoration-none">Danh mục</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase mb-3">Liên hệ</h5>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-geo-alt me-2"></i> 123 Đường ABC, TP. Hồ Chí Minh</li>
                        <li><i class="bi bi-telephone me-2"></i> +84 123 456 789</li>
                        <li><i class="bi bi-envelope me-2"></i> support@shoeshop.vn</li>
                    </ul>
                    <div class="mt-3">
                        <a href="https://facebook.com" class="text-white me-3" target="_blank"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="https://instagram.com" class="text-white me-3" target="_blank"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="https://twitter.com" class="text-white me-3" target="_blank"><i class="bi bi-twitter fs-5"></i></a>
                        <a href="https://youtube.com" class="text-white" target="_blank"><i class="bi bi-youtube fs-5"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-light">
            <div class="text-center mt-4">
                <p class="mb-0">© 2025 ShoeShop - Inspired by Nike. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function () {
            updateCartCount();
            updateWishlistCount();

            function showToast(message, isSuccess = true) {
                const toast = $('#notificationToast');
                toast.find('.toast-body').text(message);
                toast.removeClass('bg-success bg-danger').addClass(isSuccess ? 'bg-success' : 'bg-danger');
                toast.toast({ delay: 3000 });
                toast.toast('show');
            }

            function showLoading() {
                $('#loadingOverlay').fadeIn(200);
            }

            function hideLoading() {
                $('#loadingOverlay').fadeOut(200);
            }

            function updateCartCount() {
                $.get('@Url.Action("GetCartCount", "Cart")', function (count) {
                    $('#cartCount').text(`Cart (${count})`);
                }).fail(function () {
                    $('#cartCount').text('Cart (0)');
                });
            }

            function updateWishlistCount() {
                $.get('@Url.Action("GetWishlistCount", "Product")', function (count) {
                    $('#wishlistCount').text(`Wishlist (${count})`);
                }).fail(function () {
                    $('#wishlistCount').text('Wishlist (0)');
                });
            }

            $(document).on('cart-updated', updateCartCount);
            $(document.on('wishlist-updated', updateWishlistCount);
        });
    </script>
    @Html.AntiForgeryToken()
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

<style>
    /* CSS cho thanh nav */
    .navbar {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 0.5rem 1rem;
    }

    .navbar-nav .nav-link {
        color: #333 !important;
        padding: 8px 12px;
        transition: all 0.3s ease;
        border-radius: 5px;
    }

        .navbar-nav .nav-link:hover {
            color: #fff !important;
            background-color: rgba(255, 255, 255, 0.2);
        }

    .admin-dashboard-link {
        font-weight: bold;
        background-color: rgba(255, 255, 255, 0.1);
    }

        .admin-dashboard-link:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

    .employee-dashboard-link {
        background-color: rgba(255, 255, 255, 0.05);
    }

        .employee-dashboard-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

    .dropdown-menu {
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .dropdown-item {
        transition: background-color 0.3s ease;
    }

        .dropdown-item:hover {
            background-color: #e0e0e0;
        }

    .navbar-brand:hover img {
        transform: scale(1.1);
    }

    .navbar-toggler-icon {
        filter: invert(20%);
    }

    .toast-container {
        z-index: 1050;
    }

    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
    }

    .loading-spinner {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 50px;
        height: 50px;
        border: 5px solid #fff;
        border-top: 5px solid #FFBD71;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% {
            transform: translate(-50%, -50%) rotate(0deg);
        }

        100% {
            transform: translate(-50%, -50%) rotate(360deg);
        }
    }
</style>